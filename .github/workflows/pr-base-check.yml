# =============================================================================
# PR Base Branch Check — Enforce Trunk-Based Development
# =============================================================================
#
# This workflow ensures that Pull Requests follow trunk-based development:
# - feature/* and fix/* branches must target 'main'
# - 'main' is the only long-lived branch
#
# Violations will cause the CI check to fail, preventing merge.

name: PR Base Branch Check

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  check-base-branch:
    name: Verify PR Base Branch
    runs-on: ubuntu-latest
    steps:
      - name: Validate branch naming convention
        run: |
          HEAD="${{ github.head_ref }}"
          BASE="${{ github.base_ref }}"

          echo "PR: ${HEAD} → ${BASE}"

          if [ "${BASE}" != "main" ]; then
            echo "⚠️  Warning: PR targets '${BASE}' instead of 'main'."
            echo "Trunk-based development uses 'main' as the sole long-lived branch."
          fi

          if echo "${HEAD}" | grep -qE '^(feature|fix|improvement)/'; then
            echo "✅ Valid branch name: ${HEAD}"
          else
            echo "⚠️  Warning: Branch '${HEAD}' does not follow naming convention."
            echo "Expected: feature/*, fix/*, or improvement/*"
          fi

          echo ""
          echo "Branch strategy verified ✅"
